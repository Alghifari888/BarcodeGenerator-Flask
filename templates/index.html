<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barcode Generator</title>
    <!-- Load Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        select option:disabled {
            background: #e5e7eb;
            color: #9ca3af;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="w-full max-w-lg mx-auto p-4">
        <div class="bg-white p-8 rounded-2xl shadow-lg">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">Barcode Generator</h1>
                <p class="text-gray-500 mt-2">Buat barcode atau QR code dengan mudah.</p>
            </div>

            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
                {% for category, message in messages %}
                  <!-- PERBAIKAN DI SINI: Mengganti 'set-bg_color' menjadi 'set bg_color' -->
                  {% set bg_color = 'bg-red-100 border-red-400 text-red-700' if category == 'error' else 'bg-yellow-100 border-yellow-400 text-yellow-700' %}
                  <div class="{{ bg_color }} px-4 py-3 rounded-lg relative mb-6" role="alert">
                    <span class="block sm:inline">{{ message }}</span>
                  </div>
                {% endfor %}
              {% endif %}
            {% endwith %}

            <form action="{{ url_for('generate') }}" method="post">
                <div class="mb-6">
                    <label for="data" class="block text-gray-700 text-sm font-semibold mb-2">Data / Teks</label>
                    <input type="text" id="data" name="data" value="{{ last_data or '' }}"
                           class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-300"
                           placeholder="Masukkan teks atau angka di sini" required>
                </div>

                <div class="mb-8">
                    <label for="barcode_type" class="block text-gray-700 text-sm font-semibold mb-2">Jenis Barcode</label>
                    <select id="barcode_type" name="barcode_type"
                            class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-300">
                        <option value="code128">Code128</option>
                        <option value="ean13">EAN-13 (12 digit)</option>
                        <option value="upca">UPC-A (11 digit)</option>
                        <option value="qrcode">QR Code</option>
                    </select>
                </div>

                <div id="color-options" class="hidden space-y-4 mb-8">
                    <h3 class="text-gray-700 text-sm font-semibold mb-2">Opsi Warna (Khusus QR Code)</h3>
                    <div class="flex items-center justify-between">
                        <label for="fill_color" class="text-gray-600">Warna Utama:</label>
                        <input type="color" id="fill_color" name="fill_color" value="#000000" class="h-8 w-14 rounded-md border border-gray-300">
                    </div>
                    <div class="flex items-center justify-between">
                        <label for="back_color" class="text-gray-600">Warna Latar:</label>
                        <input type="color" id="back_color" name="back_color" value="#FFFFFF" class="h-8 w-14 rounded-md border border-gray-300">
                    </div>
                </div>

                <div class="mb-8">
                    <label for="output_format" class="block text-gray-700 text-sm font-semibold mb-2">Format Output</label>
                    <select id="output_format" name="output_format"
                            class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-300">
                        <option value="png">PNG (Gambar Biasa)</option>
                        <option value="svg">SVG (Vektor, Kualitas Tinggi)</option>
                    </select>
                </div>

                <div class="flex items-center justify-center">
                    <button type="submit"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg focus:outline-none focus:shadow-outline transform hover:scale-105 transition duration-300">
                        Generate Barcode
                    </button>
                </div>
            </form>
        </div>
        <p class="text-center text-gray-500 text-xs mt-6">
            &copy;2024 Barcode Generator App.
        </p>
    </div>

    <!-- JAVASCRIPT PINTAR UNTUK MENCEGAH ERROR -->
    <script>
        function handleBarcodeTypeChange() {
            const barcodeTypeSelect = document.getElementById('barcode_type');
            const colorOptions = document.getElementById('color-options');
            const formatSelect = document.getElementById('output_format');
            const svgOption = formatSelect.querySelector('option[value="svg"]');

            if (barcodeTypeSelect.value === 'qrcode') {
                colorOptions.classList.remove('hidden');
                // Otomatis pilih PNG dan non-aktifkan opsi SVG
                formatSelect.value = 'png';
                svgOption.disabled = true;
            } else {
                colorOptions.classList.add('hidden');
                // Aktifkan kembali opsi SVG untuk tipe lain
                svgOption.disabled = false;
            }
        }

        // Jalankan fungsi saat pilihan jenis barcode berubah
        document.getElementById('barcode_type').addEventListener('change', handleBarcodeTypeChange);

        // Jalankan juga saat halaman pertama kali dimuat, untuk jaga-jaga
        document.addEventListener('DOMContentLoaded', handleBarcodeTypeChange);
    </script>
</body>
</html>
